<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.competitionapply.mapper.CompetitionApplyMapper">
    
    <resultMap type="CompetitionApply" id="CompetitionApplyResult">
        <result property="id"    column="id"    />
        <result property="applyNo"    column="apply_no"    />
        <result property="applicantUserId"    column="applicant_user_id"    />
        <result property="applicantDepId"    column="applicant_dep_id"    />
        <result property="name"    column="name"    />
        <result property="category"    column="category"    />
        <result property="organizations"    column="organizations"    />
        <result property="level"    column="level"    />
        <result property="scopeType"    column="scope_type"    />
        <result property="status"    column="status"    />
        <result property="tags"    column="tags"    />
        <result property="memo"    column="memo"    />
        <result property="auditBy"    column="audit_by"    />
        <result property="auditTime"    column="audit_time"    />
        <result property="auditRemark"    column="audit_remark"    />
        <result property="competitionId"    column="competition_id"    />
        <result property="createBy"    column="create_by"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateBy"    column="update_by"    />
        <result property="updateTime"    column="update_time"    />
        <result property="remark"    column="remark"    />
        <result property="delFlag"    column="del_flag"    />
    </resultMap>

    <resultMap id="CompetitionApplyCompetitionApplyAttachmentResult" type="CompetitionApply" extends="CompetitionApplyResult">
        <collection property="competitionApplyAttachmentList" ofType="CompetitionApplyAttachment" column="id" select="selectCompetitionApplyAttachmentList" />
    </resultMap>

    <resultMap type="CompetitionApplyAttachment" id="CompetitionApplyAttachmentResult">
        <result property="id"    column="id"    />
        <result property="applyId"    column="apply_id"    />
        <result property="type"    column="type"    />
        <result property="fileType"    column="file_type"    />
        <result property="originName"    column="origin_name"    />
        <result property="storeName"    column="store_name"    />
        <result property="filePath"    column="file_path"    />
        <result property="fileUrl"    column="file_url"    />
        <result property="fileSize"    column="file_size"    />
        <result property="uploadBy"    column="upload_by"    />
        <result property="uploadTime"    column="upload_time"    />
        <result property="remark"    column="remark"    />
        <result property="delFlag"    column="del_flag"    />
    </resultMap>

    <sql id="selectCompetitionApplyVo">
        select id, apply_no, applicant_user_id, applicant_dep_id, name, category, organizations, level, scope_type, status, tags, memo, audit_by, audit_time, audit_remark, competition_id, create_by, create_time, update_by, update_time, remark, del_flag from competition_apply
    </sql>

    <select id="selectCompetitionApplyList" parameterType="CompetitionApply" resultMap="CompetitionApplyResult">
        <include refid="selectCompetitionApplyVo"/>
        <where>  
            <if test="applyNo != null  and applyNo != ''"> and apply_no = #{applyNo}</if>
            <if test="applicantUserId != null "> and applicant_user_id = #{applicantUserId}</if>
            <if test="applicantDepId != null "> and applicant_dep_id = #{applicantDepId}</if>
            <if test="name != null  and name != ''"> and name like concat('%', #{name}, '%')</if>
            <if test="category != null  and category != ''"> and category = #{category}</if>
            <if test="level != null  and level != ''"> and level = #{level}</if>
            <if test="scopeType != null  and scopeType != ''"> and scope_type = #{scopeType}</if>
            <if test="status != null  and status != ''"> and status = #{status}</if>
            <if test="memo != null  and memo != ''"> and memo = #{memo}</if>
        </where>
    </select>
    
    <select id="selectCompetitionApplyById" parameterType="Long" resultMap="CompetitionApplyCompetitionApplyAttachmentResult">
        select id, apply_no, applicant_user_id, applicant_dep_id, name, category, organizations, level, scope_type, status, tags, memo, audit_by, audit_time, audit_remark, competition_id, create_by, create_time, update_by, update_time, remark, del_flag
        from competition_apply
        where id = #{id}
    </select>

    <select id="selectCompetitionApplyAttachmentList" resultMap="CompetitionApplyAttachmentResult">
        select id, apply_id, type, file_type, origin_name, store_name, file_path, file_url, file_size, upload_by, upload_time, remark, del_flag
        from competition_apply_attachment
        where apply_id = #{apply_id}
    </select>

    <insert id="insertCompetitionApply" parameterType="CompetitionApply" useGeneratedKeys="true" keyProperty="id">
        insert into competition_apply
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="applyNo != null and applyNo != ''">apply_no,</if>
            <if test="applicantUserId != null">applicant_user_id,</if>
            <if test="applicantDepId != null">applicant_dep_id,</if>
            <if test="name != null and name != ''">name,</if>
            <if test="category != null and category != ''">category,</if>
            <if test="organizations != null and organizations != ''">organizations,</if>
            <if test="level != null and level != ''">level,</if>
            <if test="scopeType != null and scopeType != ''">scope_type,</if>
            <if test="status != null and status != ''">status,</if>
            <if test="tags != null">tags,</if>
            <if test="memo != null">memo,</if>
            <if test="auditBy != null">audit_by,</if>
            <if test="auditTime != null">audit_time,</if>
            <if test="auditRemark != null">audit_remark,</if>
            <if test="competitionId != null">competition_id,</if>
            <if test="createBy != null">create_by,</if>
            <if test="createTime != null">create_time,</if>
            <if test="updateBy != null">update_by,</if>
            <if test="updateTime != null">update_time,</if>
            <if test="remark != null">remark,</if>
            <if test="delFlag != null">del_flag,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="applyNo != null and applyNo != ''">#{applyNo},</if>
            <if test="applicantUserId != null">#{applicantUserId},</if>
            <if test="applicantDepId != null">#{applicantDepId},</if>
            <if test="name != null and name != ''">#{name},</if>
            <if test="category != null and category != ''">#{category},</if>
            <if test="organizations != null and organizations != ''">#{organizations},</if>
            <if test="level != null and level != ''">#{level},</if>
            <if test="scopeType != null and scopeType != ''">#{scopeType},</if>
            <if test="status != null and status != ''">#{status},</if>
            <if test="tags != null">#{tags},</if>
            <if test="memo != null">#{memo},</if>
            <if test="auditBy != null">#{auditBy},</if>
            <if test="auditTime != null">#{auditTime},</if>
            <if test="auditRemark != null">#{auditRemark},</if>
            <if test="competitionId != null">#{competitionId},</if>
            <if test="createBy != null">#{createBy},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="updateBy != null">#{updateBy},</if>
            <if test="updateTime != null">#{updateTime},</if>
            <if test="remark != null">#{remark},</if>
            <if test="delFlag != null">#{delFlag},</if>
         </trim>
    </insert>

    <update id="updateCompetitionApply" parameterType="CompetitionApply">
        update competition_apply
        <trim prefix="SET" suffixOverrides=",">
            <if test="applyNo != null and applyNo != ''">apply_no = #{applyNo},</if>
            <if test="applicantUserId != null">applicant_user_id = #{applicantUserId},</if>
            <if test="applicantDepId != null">applicant_dep_id = #{applicantDepId},</if>
            <if test="name != null and name != ''">name = #{name},</if>
            <if test="category != null and category != ''">category = #{category},</if>
            <if test="organizations != null and organizations != ''">organizations = #{organizations},</if>
            <if test="level != null and level != ''">level = #{level},</if>
            <if test="scopeType != null and scopeType != ''">scope_type = #{scopeType},</if>
            <if test="status != null and status != ''">status = #{status},</if>
            <if test="tags != null">tags = #{tags},</if>
            <if test="memo != null">memo = #{memo},</if>
            <if test="auditBy != null">audit_by = #{auditBy},</if>
            <if test="auditTime != null">audit_time = #{auditTime},</if>
            <if test="auditRemark != null">audit_remark = #{auditRemark},</if>
            <if test="competitionId != null">competition_id = #{competitionId},</if>
            <if test="createBy != null">create_by = #{createBy},</if>
            <if test="createTime != null">create_time = #{createTime},</if>
            <if test="updateBy != null">update_by = #{updateBy},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
            <if test="remark != null">remark = #{remark},</if>
            <if test="delFlag != null">del_flag = #{delFlag},</if>
        </trim>
        where id = #{id}
    </update>

    <delete id="deleteCompetitionApplyById" parameterType="Long">
        delete from competition_apply where id = #{id}
    </delete>

    <delete id="deleteCompetitionApplyByIds" parameterType="String">
        delete from competition_apply where id in 
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>
    
    <delete id="deleteCompetitionApplyAttachmentByApplyIds" parameterType="String">
        delete from competition_apply_attachment where apply_id in 
        <foreach item="applyId" collection="array" open="(" separator="," close=")">
            #{applyId}
        </foreach>
    </delete>

    <delete id="deleteCompetitionApplyAttachmentByApplyId" parameterType="Long">
        delete from competition_apply_attachment where apply_id = #{applyId}
    </delete>

    <insert id="batchCompetitionApplyAttachment">
        insert into competition_apply_attachment( id, apply_id, type, file_type, origin_name, store_name, file_path, file_url, file_size, upload_by, upload_time, remark, del_flag) values
        <foreach item="item" index="index" collection="list" separator=",">
            ( #{item.id}, #{item.applyId}, #{item.type}, #{item.fileType}, #{item.originName}, #{item.storeName}, #{item.filePath}, #{item.fileUrl}, #{item.fileSize}, #{item.uploadBy}, #{item.uploadTime}, #{item.remark}, #{item.delFlag})
        </foreach>
    </insert>
</mapper>